<UserControl x:Class="ServoPress.Views.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ServoPress.Models"
             mc:Ignorable="d" 
             d:DesignHeight="900" d:DesignWidth="1050">
    <!-- 
    子界面 3: 参数设置
    -->
    <TabControl Margin="10">

        <!-- 模块 1: 基础设置与硬件标定 -->
        <TabItem Header="硬件标定与通道">
            <StackPanel Margin="10">
                <GroupBox Header="X 通道 (位移)">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="传感器类型:" Grid.Row="0" Grid.Column="0" Margin="5" VerticalAlignment="Center"/>
                        <ComboBox Text="伺服编码器" Grid.Row="0" Grid.Column="1" Margin="5" SelectedIndex="0">
                            <ComboBoxItem Content="伺服编码器"/>
                            <ComboBoxItem Content="光栅尺"/>
                        </ComboBox>
                        <TextBlock Text="单位:" Grid.Row="0" Grid.Column="2" Margin="5" VerticalAlignment="Center"/>
                        <TextBox Text="mm" Grid.Row="0" Grid.Column="3" Margin="5"/>

                        <TextBlock Text="行程范围:" Grid.Row="1" Grid.Column="0" Margin="5" VerticalAlignment="Center"/>
                        <TextBox Text="0 - 100.00" Grid.Row="1" Grid.Column="1" Margin="5"/>
                        <TextBlock Text="小数位数:" Grid.Row="1" Grid.Column="2" Margin="5" VerticalAlignment="Center"/>
                        <TextBox Text="2" Grid.Row="1" Grid.Column="3" Margin="5"/>
                    </Grid>
                </GroupBox>
                <GroupBox Header="Y 通道 (压力)">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="传感器类型:" Grid.Row="0" Grid.Column="0" Margin="5" VerticalAlignment="Center"/>
                        <ComboBox Text="应变片" Grid.Row="0" Grid.Column="1" Margin="5" SelectedIndex="0">
                            <ComboBoxItem Content="应变片"/>
                            <ComboBoxItem Content="压电"/>
                        </ComboBox>
                        <TextBlock Text="单位:" Grid.Row="0" Grid.Column="2" Margin="5" VerticalAlignment="Center"/>
                        <TextBox Text="N" Grid.Row="0" Grid.Column="3" Margin="5"/>

                        <TextBlock Text="量程:" Grid.Row="1" Grid.Column="0" Margin="5" VerticalAlignment="Center"/>
                        <TextBox Text="0 - 5000.0" Grid.Row="1" Grid.Column="1" Margin="5"/>
                        <TextBlock Text="小数位数:" Grid.Row="1" Grid.Column="2" Margin="5" VerticalAlignment="Center"/>
                        <TextBox Text="1" Grid.Row="1" Grid.Column="3" Margin="5"/>
                    </Grid>
                </GroupBox>
                <StackPanel Orientation="Horizontal" Margin="5,20,5,5">
                    <Button Content="机械零点标定" Style="{StaticResource ResetButtonStyle}" Margin="5"/>
                    <Button Content="压力传感器清零" Style="{StaticResource ResetButtonStyle}" Margin="20,5,5,5"/>
                </StackPanel>
            </StackPanel>
        </TabItem>

        <!-- 模块 2: 手动模式 (点动) - 新增选项卡 -->
        <TabItem Header="手动模式 (点动)">
            <StackPanel Margin="10">
                <GroupBox Header="手动控制" Margin="5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="点动 +" Margin="5" Padding="15,10" FontSize="14" ToolTip="按住以上升"/>
                        <Button Grid.Column="1" Content="点动 -" Margin="5" Padding="15,10" FontSize="14" ToolTip="按住以下降"/>
                    </Grid>
                </GroupBox>
                <!-- 未来可以扩展其他手动功能, 例如回原点按钮 -->
                <Button Content="手动回原点" Style="{StaticResource ResetButtonStyle}" Margin="10,20,10,10" Padding="10"/>
            </StackPanel>
        </TabItem>

        <!-- 模块 3: 压装曲线评估 -->
        <TabItem Header="评估窗口 (Evaluation)">
            <GroupBox Header="评估窗口列表" Margin="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <DataGrid Grid.Row="0">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="启用" Binding="{Binding Enabled}" Width="Auto"/>
                            <DataGridTextColumn Header="窗口名称" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="类型" Binding="{Binding Type}" Width="Auto"/>
                            <DataGridTextColumn Header="参数 (X1, Y1, X2, Y2)" Binding="{Binding Params}" Width="2*"/>
                        </DataGrid.Columns>
                        <!-- 示例数据 -->
                        <DataGrid.ItemsSource>
                            <x:Array Type="{x:Type local:EvalWindow}">
                                <local:EvalWindow Enabled="True" Name="最终判定框" Type="UniBox" Params="X[65.0, 70.0], Y[350.0, 450.0]"/>
                                <local:EvalWindow Enabled="True" Name="过程监控" Type="LineX" Params="X[30.0], Y[50.0, 150.0]"/>
                                <local:EvalWindow Enabled="False" Name="禁止触碰" Type="NoPass" Params="X[0, 20.0], Y[10.0, 5000.0]"/>
                            </x:Array>
                        </DataGrid.ItemsSource>
                    </DataGrid>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                        <Button Content="添加 (UniBox)" Margin="5"/>
                        <Button Content="添加 (LineX)" Margin="5"/>
                        <Button Content="添加 (NoPass)" Margin="5"/>
                        <Button Content="删除" Margin="5"/>
                    </StackPanel>
                </Grid>
            </GroupBox>
        </TabItem>

        <!-- 模块 4 (部分): 过程值配置 -->
        <TabItem Header="过程值 (P-Values)">
            <GroupBox Header="过程值提取配置" Margin="10">
                <DataGrid>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="过程值名称" Binding="{Binding Name}" Width="*"/>
                        <DataGridComboBoxColumn Header="提取方式" Width="*"/>
                        <DataGridTextColumn Header="参数 (例如: 评估窗口名)" Binding="{Binding Param}" Width="*"/>
                    </DataGrid.Columns>
                    <DataGrid.ItemsSource>
                        <x:Array Type="{x:Type local:PValueConfig}">
                            <local:PValueConfig Name="最大压力" Method="Max Y" Param=""/>
                            <local:PValueConfig Name="最终位移" Method="End X" Param=""/>
                            <local:PValueConfig Name="Box进入Y值" Method="Enter Y" Param="最终判定框"/>
                        </x:Array>
                    </DataGrid.ItemsSource>
                </DataGrid>
            </GroupBox>
        </TabItem>
    </TabControl>
</UserControl>